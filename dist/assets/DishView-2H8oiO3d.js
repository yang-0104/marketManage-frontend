import{d as ne,r as f,j as se,a as s,c as h,b as e,w as t,F as D,o as _,g as V,e as u,t as E,u as B,n as ue,k as N,l as z,m as L,E as k,q as ce,s as re,v as ie,_ as de}from"./index-UUeNv-ow.js";import{g as pe,a as me,b as ve,u as fe,d as O,e as _e,c as ge}from"./index-hVcYNRJg.js";const ye={class:"card_head"},be={class:"card_body"},Ve=["src"],Ce={class:"card_bottom"},he=["id"],ke=["src"],xe=ne({__name:"DishView",setup(we){const g=f(!1),S=f(""),U=f([{label:"售卖",status:1},{label:"下架",status:0}]),C=f({}),M=async()=>{console.log("refresh category list");const n=await pe();C.value=n,console.log(C.value)},q=async n=>{L.success("上传中..."),console.log("上传图片"),console.log(n);const a=new FormData;a.append("smfile",n.file);const d=await ve.post("/image",a,{headers:{"Content-Type":"multipart/form-data",Authorization:"vloeMSvgqoEZbHxCw1tYBkIPlsSOa1OZ"}}),y=d.data;if(y.success){console.log(d);const r=y.data.url;o.value.cover=r}else o.value.cover=y.images;L.success("图片上传成功")},F=async()=>{console.log("submit!"),g.value=!await fe(o.value),v()},o=f({}),b=f([]);function I(){S.value="果蔬添加",g.value=!0,o.value={}}function J(n){S.value="果蔬编辑",g.value=!0,o.value={},o.value.cid=n.cid,o.value.cover=n.cover,o.value.descr=n.descr,o.value.discount=n.discount,o.value.id=n.id,o.value.name=n.name,o.value.price=n.price,o.value.status=n.status}function j(n){console.log("删除"+JSON.stringify(n)),k.confirm("确认删除该果蔬吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await O([n.id])&&v()})}const x=f(""),c=f({records:[],current:1,size:5,total:0}),A=n=>{console.log(`keyword: ${n}`),v()},P=async n=>{console.log(`current page: ${n}`),c.value.current=n,v()},Z=n=>{console.log(`selected: ${JSON.stringify(n)}`),b.value=n.map(a=>a.id),console.log(`selectedDish: ${JSON.stringify(b.value)}`)},H=async()=>{console.log("批量删除"),k.confirm("确认删除选中果蔬吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await O(b.value)&&v()})},K=async()=>{console.log("批量启售"),k.confirm("确认启售选中果蔬吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await _e(b.value)&&v()})},Y=async()=>{console.log("批量停售"),k.confirm("确认停售选中果蔬吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await ge(b.value)&&v()})},v=async()=>{console.log("获取果蔬列表");const n=await me(c.value.current,c.value.size,x.value);c.value=n};return se(()=>{v(),M()}),(n,a)=>{const d=s("el-input"),y=s("el-col"),r=s("el-button"),G=s("el-row"),i=s("el-table-column"),Q=s("el-tag"),R=s("el-button-group"),W=s("el-table"),X=s("el-pagination"),ee=s("el-card"),p=s("el-form-item"),T=s("el-option"),$=s("el-select"),le=s("el-icon"),ae=s("el-upload"),te=s("el-form"),oe=s("el-drawer");return _(),h(D,null,[e(ee,{class:"card"},{default:t(()=>[V("div",ye,[e(G,null,{default:t(()=>[e(y,{span:12},{default:t(()=>[e(d,{size:"large","prefix-icon":"Search",style:{width:"20vw"},autocomlpete:"off",placeholder:"请输入果蔬名称",onInput:A,modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=l=>x.value=l)},null,8,["modelValue"])]),_:1}),e(y,{span:12,style:{"text-align":"right"}},{default:t(()=>[e(r,{size:"large",type:"danger",text:"",onClick:a[1]||(a[1]=l=>H())},{default:t(()=>[u("批量删除")]),_:1}),e(r,{size:"large",type:"success",text:"",onClick:a[2]||(a[2]=l=>K())},{default:t(()=>[u(" 批量启售")]),_:1}),e(r,{size:"large",type:"danger",text:"",onClick:a[3]||(a[3]=l=>Y())},{default:t(()=>[u("批量停售")]),_:1}),e(r,{size:"large",type:"primary",onClick:I},{default:t(()=>[u("+添加果蔬")]),_:1})]),_:1})]),_:1})]),V("div",be,[e(W,{data:c.value.records,style:{width:"100%"},border:"",onSelectionChange:Z},{default:t(()=>[e(i,{type:"selection"}),e(i,{prop:"name",label:"名称"}),e(i,{prop:"cover",label:"图片"},{default:t(({row:l})=>[V("img",{src:l.cover,style:{width:"100%",height:"100%","border-radius":"5px"}},null,8,Ve)]),_:1}),e(i,{prop:"descr",label:"简介"}),e(i,{prop:"category",label:"分类"},{default:t(({row:l})=>{var m;return[u(E((m=C.value.records.find(w=>w.id===l.cid))==null?void 0:m.name),1)]}),_:1}),e(i,{prop:"price",label:"售价"}),e(i,{prop:"discount",label:"折扣"}),e(i,{prop:"status",label:"售卖状态"},{default:t(({row:l})=>[e(Q,{type:l.status===1?"success":"danger",effect:"dark"},{default:t(()=>{var m;return[u(E((m=U.value.find(w=>w.status===l.status))==null?void 0:m.label),1)]}),_:2},1032,["type"])]),_:1}),e(i,{prop:"inventory",label:"库存"}),e(i,{label:"操作"},{default:t(({row:l})=>[e(R,null,{default:t(()=>[e(r,{icon:B(ce),circle:"",plain:"",type:"primary",onClick:m=>J(l)},null,8,["icon","onClick"]),e(r,{icon:B(re),circle:"",plain:"",type:"danger",onClick:m=>j(l)},null,8,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),V("div",Ce,[e(X,{"current-page":c.value.current,"onUpdate:currentPage":a[4]||(a[4]=l=>c.value.current=l),"page-size":c.value.size,"onUpdate:pageSize":a[5]||(a[5]=l=>c.value.size=l),layout:"total, prev, pager, next, jumper",total:c.value.total,onCurrentChange:P},null,8,["current-page","page-size","total"])])]),_:1}),e(oe,{modelValue:g.value,"onUpdate:modelValue":a[14]||(a[14]=l=>g.value=l),"show-close":!1},{header:t(({titleId:l,titleClass:m})=>[V("h4",{id:l,class:ue(m)},"果蔬添加",10,he)]),default:t(()=>[e(te,{model:o.value,"label-width":"120px","label-position":"left"},{default:t(()=>[e(p,{label:"果蔬名称"},{default:t(()=>[e(d,{modelValue:o.value.name,"onUpdate:modelValue":a[6]||(a[6]=l=>o.value.name=l),"prefix-icon":"Dish",placeholder:"朗朗上口名经传"},null,8,["modelValue"])]),_:1}),e(p,{label:"果蔬分类"},{default:t(()=>[e($,{modelValue:o.value.cid,"onUpdate:modelValue":a[7]||(a[7]=l=>o.value.cid=l),placeholder:"选择分类"},{default:t(()=>[(_(!0),h(D,null,N(C.value.records,l=>(_(),z(T,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"果蔬图片"},{default:t(()=>[e(ae,{class:"avatar-uploader","show-file-list":!1,"http-request":q},{default:t(()=>[o.value.cover?(_(),h("img",{key:0,src:o.value.cover,class:"avatar-uploader-img"},null,8,ke)):(_(),z(le,{key:1,class:"avatar-uploader-icon"},{default:t(()=>[e(B(ie))]),_:1}))]),_:1})]),_:1}),e(p,{label:"果蔬价格"},{default:t(()=>[e(d,{modelValue:o.value.price,"onUpdate:modelValue":a[8]||(a[8]=l=>o.value.price=l),"prefix-icon":"Coin",type:"number",placeholder:"作价几许？"},{append:t(()=>[u("元")]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"果蔬状态"},{default:t(()=>[e($,{modelValue:o.value.status,"onUpdate:modelValue":a[9]||(a[9]=l=>o.value.status=l),placeholder:"选择状态"},{default:t(()=>[(_(!0),h(D,null,N(U.value,l=>(_(),z(T,{key:l.status,label:l.label,value:l.status},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"果蔬折扣"},{default:t(()=>[e(d,{modelValue:o.value.discount,"onUpdate:modelValue":a[10]||(a[10]=l=>o.value.discount=l),"prefix-icon":"Discount",placeholder:"来即是客，我打个折"},{append:t(()=>[u("%")]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"库存"},{default:t(()=>[e(d,{modelValue:o.value.inventory,"onUpdate:modelValue":a[11]||(a[11]=l=>o.value.inventory=l),"prefix-icon":"Discount",placeholder:"修改库存"},{append:t(()=>[u("kg")]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"果蔬简介"},{default:t(()=>[e(d,{modelValue:o.value.descr,"onUpdate:modelValue":a[12]||(a[12]=l=>o.value.descr=l),type:"textarea",placeholder:"给食客一句话的考虑时间"},null,8,["modelValue"])]),_:1}),e(p,null,{default:t(()=>[e(r,{type:"primary",onClick:F},{default:t(()=>[u("提交")]),_:1}),e(r,{onClick:a[13]||(a[13]=l=>g.value=!1)},{default:t(()=>[u("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),ze=de(xe,[["__scopeId","data-v-d88501c9"]]);export{ze as default};
